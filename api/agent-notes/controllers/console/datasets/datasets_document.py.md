## Purpose

`api/controllers/console/datasets/datasets_document.py` contains the console (authenticated) APIs for managing dataset documents (list/create/update/delete, processing controls, estimates, etc.).

## Storage model (uploaded files)

- For local file uploads into a knowledge base, the binary is stored via `extensions.ext_storage.storage` under the key:
  - `upload_files/<tenant_id>/<uuid>.<ext>`
- File metadata is stored in the `upload_files` table (`UploadFile` model), keyed by `UploadFile.id`.
- Dataset `Document` records reference the uploaded file via:
  - `Document.data_source_info.upload_file_id`

## Download endpoint

- `GET /datasets/<dataset_id>/documents/<document_id>/download`
  - Only supported when `Document.data_source_type == "upload_file"`.
  - Performs dataset permission + tenant checks via `DocumentResource.get_document(...)`.
  - Validates the referenced `UploadFile` exists for the same tenant.
  - Returns a signed URL generated by `core.file.helpers.get_signed_file_url(..., as_attachment=True)`.
  - Applies `cloud_edition_billing_rate_limit_check("knowledge")` to match other KB operations.
  - Response body is **only**: `{ "url": "<signed-url>" }`.

## Verification plan

- Upload a document from a local file into a dataset.
- Call the download endpoint and confirm it returns a signed URL.
- Open the URL and confirm:
  - Response headers force download (`Content-Disposition`), and
  - Downloaded bytes match the uploaded file.

