# OutputRegistry

## Overview

The OutputRegistry is a thread-safe storage component that manages node outputs in the workflow graph engine. It provides centralized storage and retrieval of both scalar values and streaming data chunks generated by workflow nodes during execution.

## Core Functions

### 1. Thread-Safe Storage

- Ensures concurrent access safety through internal locking mechanisms
- Prevents race conditions when multiple nodes produce or consume outputs simultaneously
- Maintains data consistency across parallel execution paths

### 2. Dual Output Type Support

- **Scalar Values**: Stores single, complete values produced by nodes (e.g., computed results, transformed data)
- **Streaming Data**: Manages sequential chunks of data that arrive over time (e.g., LLM responses, progressive transformations)

### 3. Stream State Management

- Tracks read positions for each stream to support multiple consumers
- Maintains stream closure state to signal completion
- Provides unread detection for efficient processing

## Key Principles

### Selector-Based Access

All outputs are identified by selectors - hierarchical paths that uniquely identify data locations within the workflow. This enables precise data routing between nodes without direct coupling.

### Separation of Concerns

The registry isolates output storage logic from node execution logic, allowing nodes to focus on their core functionality while delegating storage management to the registry.

### Memory Efficiency

Streams maintain read positions rather than duplicating data for each consumer, optimizing memory usage in workflows with multiple downstream consumers.

### Progressive Processing

The streaming interface supports progressive data processing, allowing downstream nodes to begin processing before upstream nodes complete, reducing overall workflow latency.

## Usage Pattern

The OutputRegistry serves as the central data exchange hub in the workflow engine:

1. **Producer nodes** write their outputs (scalar or streaming) to the registry using selectors
2. **Consumer nodes** read required inputs from the registry using the same selector system
3. **The coordinator** monitors stream states to trigger downstream processing
4. **The engine** ensures proper cleanup and resource management

This design enables flexible, decoupled workflow execution where nodes can operate independently while sharing data through the registry's controlled interface.
