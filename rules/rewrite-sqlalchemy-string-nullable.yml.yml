id: rewrite-sqlalchemy-string-nullable-true
language: python
rule:
  pattern: $X = mapped_column($$$ARGS)
  any:
    - pattern: $X = mapped_column($$$BEFORE, sa.String($LENGTH), $$$MID, nullable=True, $$$AFTER)
    - pattern: $X = mapped_column($$$BEFORE, sa.String($LENGTH), $$$MID, nullable=True)
    - pattern: $X = mapped_column($$$BEFORE, String($LENGTH), $$$MID, nullable=True, $$$AFTER)
    - pattern: $X = mapped_column($$$BEFORE, String($LENGTH), $$$MID, nullable=True)
rewriters:
- id: filter-nullable-true-arg
  rule:
    pattern: $ARG
    inside:
      kind: argument_list
    all:
    - not:
        pattern:
          context: a(nullable=True)
          selector: keyword_argument
  fix: $ARG

transform:
  NEWARGS:
    rewrite:
      rewriters: [filter-nullable-true-arg]
      source: $$$ARGS
      joinBy: ', '
fix: |-
  $X: Mapped[str | None] = mapped_column($NEWARGS)
