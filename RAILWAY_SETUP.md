# ðŸš„ Railway Deployment Guide

Complete guide to deploy Dify on Railway with automatic updates.

## ðŸŽ¯ Quick Setup (5 minutes)

### 1. Create Railway Account
1. Go to [railway.app](https://railway.app)
2. Sign up with GitHub (recommended)
3. Verify email if prompted

### 2. Create New Project
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login

# Create new project
railway init
```

### 3. Set Up GitHub Repository
1. Go to Railway dashboard â†’ Connect GitHub
2. Select this repository
3. Enable auto-deployment on `main` branch

### 4. Add Required Services

**In Railway Dashboard:**
1. **Add PostgreSQL Database**
   - Click "Add Service" â†’ Database â†’ PostgreSQL
   - Railway auto-generates `DATABASE_URL`

2. **Add Redis**
   - Click "Add Service" â†’ Database â†’ Redis  
   - Railway auto-generates `REDIS_URL`

3. **Add Qdrant (Vector Database)**
   - Click "Add Service" â†’ Container â†’ Docker Image
   - Use image: `qdrant/qdrant:latest`
   - Port: 6333
   - Railway auto-generates `QDRANT_URL`

### 5. Configure Environment Variables

**Copy from `.env.railway.example`:**

**Required Variables:**
```env
SECRET_KEY=your-super-secret-key-here
OPENAI_API_KEY=your-openai-api-key
MODE=api
```

**Auto-generated by Railway:**
- `DATABASE_URL` 
- `REDIS_URL`
- `QDRANT_URL`

### 6. Deploy Services

Railway will auto-deploy when you push to `main`, or manually:

```bash
railway up
```

## ðŸ”§ Advanced Configuration

### Custom Domain
1. Railway Dashboard â†’ Settings â†’ Domains
2. Add custom domain
3. Update CORS settings in environment variables

### Scaling
- **API Service**: Can handle ~100-200 concurrent users on free tier
- **Worker Service**: Processes background jobs (document parsing, etc.)
- **Database**: 1GB storage limit on free tier

### Monitoring
- Railway provides built-in metrics
- View logs: `railway logs --service api`
- Check status: `railway status`

## ðŸ’° Cost Breakdown

**Free Tier ($5/month credit):**
- API Service: ~$2-3/month
- Web Service: ~$1-2/month  
- Worker Service: ~$1-2/month
- PostgreSQL: $0 (included)
- Redis: $0 (included)

**Total: ~$4-7/month** (well within free credit!)

## ðŸš¨ Troubleshooting

### Deployment Fails
```bash
# Check logs
railway logs --service api

# Restart service
railway restart --service api
```

### Database Connection Issues
```bash
# Test connection
railway connect postgres
```

### Environment Variables
```bash
# List all variables
railway variables

# Set variable
railway variables set SECRET_KEY=your-secret-key
```

## ðŸ”„ Auto-Updates

With the workflows in place:
1. **Daily sync** with upstream Dify (creates PRs)
2. **Auto-deployment** when PRs merge to main
3. **Zero-downtime** rolling updates

## ðŸŽ‰ Success!

Your Dify instance will be available at:
- **Web App**: `https://your-project.railway.app`
- **API**: `https://your-project.railway.app/v1`

## ðŸ“ž Support

- **Railway Docs**: [docs.railway.app](https://docs.railway.app)
- **Dify Docs**: [docs.dify.ai](https://docs.dify.ai)
- **Issues**: Create GitHub issue in this repo
