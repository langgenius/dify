# Cursor Rules for Dify Project

## Frontend Testing Guidelines

> **ðŸ“– Complete Testing Documentation**: For detailed testing specifications and guidelines, see [`web/scripts/TESTING.md`](./web/scripts/TESTING.md)

When generating tests for React components:

### Key Requirements

1. **Tech Stack**: Next.js 15 + React 19 + TypeScript + Jest + React Testing Library
2. **File Naming**: `ComponentName.spec.tsx` (same directory as component)
3. **Code Style**:
   - Use `fireEvent` (not `userEvent`)
   - AAA pattern (Arrange â†’ Act â†’ Assert)
   - Test names: `"should [behavior] when [condition]"`
   - No `any` types
   - Cleanup after each test: `afterEach(() => jest.clearAllMocks())`

### Required Tests (All Components)

- âœ… Renders without crashing
- âœ… Props (required, optional, defaults)
- âœ… Edge cases (null, undefined, empty values)

### Conditional Tests (When Present in Component)

- ðŸ”„ **useState** â†’ State initialization, transitions, cleanup
- âš¡ **useEffect** â†’ Execution, dependencies, cleanup
- ðŸŽ¯ **Event Handlers** â†’ onClick, onChange, onSubmit, keyboard events
- ðŸŒ **API Calls** â†’ Loading, success, error states
- ðŸ”€ **Next.js Routing** â†’ Navigation, params, query strings
- ðŸš€ **useCallback/useMemo** â†’ Referential equality, dependencies
- âš™ï¸ **Workflow Components** â†’ Node config, data flow, validation
- ðŸ“š **Dataset Components** â†’ Upload, pagination, search
- ðŸŽ›ï¸ **Configuration Components** â†’ Form validation, persistence

### Component Complexity Strategy

- **Complexity > 50**: Refactor before testing, use integration tests and `test.each()`
- **Complexity 30-50**: Use multiple `describe` blocks to group tests
- **500+ lines**: Consider splitting component

### Coverage Goals

Aim for 100% coverage:
- Line coverage: >95%
- Branch coverage: >95%
- Function coverage: 100%
- Statement coverage: 100%

### Dify-Specific Mocks

```typescript

// Toast
jest.mock('@/app/components/base/toast')

// Next.js Router
jest.mock('next/navigation', () => ({
  useRouter: jest.fn(),
  usePathname: jest.fn(),
  useSearchParams: jest.fn(),
}))
```

---

**Important**: The above is a quick reference only. When generating tests, strictly follow the complete specifications in [`web/scripts/TESTING.md`](./web/scripts/TESTING.md), including detailed examples, best practices, and FAQs.
